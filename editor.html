<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Mixmax &middot; Meeting Spot</title>

  <!-- Mixmax SDK -->
  <script defer src="https://d1xa36cy0xt122.cloudfront.net/v1/Mixmax.js"></script>

  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css?family=Josefin+Sans|Lobster" rel="stylesheet">
  <script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.2/underscore-min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
  <script src="/lib/index.js"></script>
</head>

<body>

  <div class="app-popup">
  <h1 class="title">Let's meet in the middle</h1>
    <div class="toolbar__title  flex-fill">
      <form class="search">
        <div  class="location1-search">
          <input id="autocomplete" class="location1-search-field" placeholder="Enter Your location" onFocus="geolocate()" type="text" value=""></input>
        </div>
        
        <div class="location2-search">
          <input id="autocomplete2" class="location2-search-field" placeholder="Enter the other person's location" onFocus="geolocate()" type="text" value="">
        </div>
        <button type="submit" class="search-locations">Find Coffee Shops</button>
      </form>
    </div>
    
    <div id="search-results" class='hide'>
      <h2>Search Results</h2>
      <div id="map"></div>
    </div>
    
  </div>

  <script>
  
  function initialize() {
    initAutocomplete();
    initMap();
  }
  
  function renderMap() {
    document.getElementById('search-results').classList = [] 
    initMap();
  }
  
    var autocomplete
    var componentForm = {
      street_number: 'short_name',
      route: 'long_name',
      locality: 'long_name',
      administrative_area_level_1: 'short_name',
      country: 'long_name',
      postal_code: 'short_name'
    }

    function initAutocomplete() {
      autocomplete = new google.maps.places.Autocomplete(
          /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
          { types: ['geocode']} )
      autocomplete2 = new google.maps.places.Autocomplete(
          /** @type {!HTMLInputElement} */(document.getElementById('autocomplete2')),
          { types: ['geocode']} )
      // autocomplete.addListener('place_changed', fillInAddress)
    }

    // Bias the autocomplete object to the user's geographical location,
    // as supplied by the browser's 'navigator.geolocation' object.
    function geolocate() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var geolocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          }
          var circle = new google.maps.Circle({
            center: geolocation,
            radius: position.coords.accuracy
          })
          autocomplete.setBounds(circle.getBounds())
        })
      }
    }

    function initMap() {
        var pyrmont = {lat: 39.73766931490369, lng: -104.9506715613035};
    
        map = new google.maps.Map(document.getElementById('map'), {
          center: pyrmont,
          zoom: 15
        });
    
        infowindow = new google.maps.InfoWindow();
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch({
          location: pyrmont,
          radius: 2000,
          type: ['cafe']
        }, callback);
      }
    
      function callback(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            createMarker(results[i]);
          }
        }
      }
    
      function createMarker(place) {
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });
    
        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(place.name);
          infowindow.open(map, this);
        });
      }
    </script>

  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBpLUwZpzkUP48Yz_9WWbly35G7W-8YiN8&libraries=places&callback=initAutocomplete"
      async defer></script> -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBpLUwZpzkUP48Yz_9WWbly35G7W-8YiN8&libraries=places&callback=initialize"
        async defer></script>

</body>
</html>